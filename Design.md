# Neon Gem Rush - Design Document

## 1. 核心玩法 (Core Gameplay)
- [x] **8x8 网格三消**: 标准 Match-3 逻辑。
- [x] **交互**: 支持触摸滑动 (Swipe) 和鼠标拖拽。
- [x] **物理规则**: 消除后上方宝石下落 (Gravity)，顶部生成新宝石。
- [x] **自动重排 (Reshuffle)**: 无解时自动洗牌。

## 2. 架构与性能 (Architecture)
- [x] **ECS 架构**: 采用 Entity-Component-System 模式。
  - **GameEngine**: 核心容器，管理状态 (State) 和系统生命周期。
  - **MatchSystem**: 处理消除、交换、规则逻辑。
  - **InputSystem**: 处理输入事件和手势识别。
  - **RenderSystem**: 负责高性能 Canvas 渲染。
  - **EffectSystem**: 管理粒子和视觉特效。
- [x] **Canvas 渲染**: 使用 Canvas API 替代 DOM 操作，解决移动端性能瓶颈。
- [x] **自适应布局**: 动态计算渲染缩放 (Scale) 和 偏移 (Offset)，适配各种屏幕尺寸。

## 3. 游戏进程 (Progression)
- [x] **多关卡系统**: 预设关卡，难度递增 (目标分数、步数、颜色数量)。
- [x] **难度选择**: 简单/普通/困难模式，动态调整配置。
- [x] **游戏状态管理**: Menu -> Playing -> Win/Lose -> Menu。

## 4. 计分与连击 (Scoring & Combo)
- [x] **基础分**: 消除宝石得分。
- [x] **连击倍率**: 连续消除触发 Combo，分数倍率提升。
- [x] **连击条**: 视觉化展示连击有效时间。

## 5. 特殊宝石 (Special Gems)
- [x] **生成规则**:
  - 4连消 -> 行/列爆炸 (Row/Col Blast)。
  - 5连消 (T/L/直线) -> 区域炸弹 (Area Blast) 或 彩虹 (Rainbow)。
- [x] **效果**:
  - 行/列爆炸：消除整行/整列。
  - 区域炸弹：消除 3x3 区域。
  - 彩虹：消除全屏特定颜色。
- [x] **组合技**: 两个特殊宝石交换触发强力效果。
- [x] **手动激活**: 点击特殊宝石消耗步数直接触发。

## 6. 视觉与特效 (Visuals)
- [x] **霓虹风格**: 深色背景 + 亮色边框 + 发光特效。
- [x] **UI**: HUD 显示分数/步数，精致的弹窗设计。
- [x] **动画**:
  - 交换/移动平滑过渡 (Lerp)。
  - 消除缩放 (Pop)。
  - 屏幕震动 (Screen Shake)。
- [x] **粒子系统**: 消除和爆炸时的粒子飞溅。
- [x] **漂浮文字**: 得分提示。

## 7. 音频 (Audio)
- [x] **Web Audio API**: 实时合成音效 (无需加载外部 mp3)。
- [x] **动态音效**: 连击音调升高，胜利/失败/爆炸各有特定音效。

## 待优化项 (Future Improvements)
1. **形状检测优化**: 严格区分 T/L 型和直线型匹配，目前采用数量概率模糊判定。
2. **对象池 (Object Pooling)**: 复用粒子对象以减少垃圾回收 (GC) 开销。
